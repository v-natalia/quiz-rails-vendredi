# Quiz

# 1

How do you create a Rails app?

```
rails new monapp
```

# 2

How do you start coding a Rails project? Give the right sequence.

```

1.Coding the views
2.Coding the controllers
3.Coding the models
```

###### R: Models, Controllers, Views

# 3

How do you generate a Song model with a title and a year ?

```
rails g model Song title year:integer
```

# 4

What are the 2 created files?

```
db/migrate/timestamp_create_songs.rb
app/models/song.rb
```

#  5

What is the rails command you should type then?

```
rails db:migrate
```

# 6

How do you add a category (ex: “rock” , “electro” , etc..) to your songs table using the correct Rails generator?

```
rails g migration AddCategoryToSongs category:string

rails g migration add_category_to_songs category:string
```

# 7

What is the created file?

```
db/migrate/timestamp_add_category_to_songs.rb
```

# 8

What is the rails command you should type again?

```
rails db:migrate
```

# 9

Add a validation on the presence of a song title in the models/song.rb file

```
class Song < ApplicationRecord
  validates :title, presence: true
end
```

# 10

Now crash-test your model’s validation:

```
➜ rails c
irb>
irb(main):003> song.valid?
=> false
irb(main):004> song.errors.full_messages
=> ["Title can't be blank"]
irb(main):005> song.title = "hey jude"
=> "hey jude"
irb(main):006> song.valid?
=> true
irb(main):007> song.save
  TRANSACTION (0.1ms)  begin transaction
  Song Create (0.5ms)  INSERT INTO "songs" ("title", "year", "created_at", "updated_at") VALUES (?, ?, ?, ?) RETURNING "id"  [["title", "hey jude"], ["year", nil], ["created_at", "2024-06-07 16:54:27.226989"], ["updated_at", "2024-06-07 16:54:27.226989"]]
  TRANSACTION (7.1ms)  commit transaction
=> true

```

# 11

What is the Rails flow you need to follow again and again? Give the correct order.

```
1.The Router is routing the HTTP request to controller#action.
2.The action is getting data from models.
3.Everything starts with an HTTP Request.
4.The action is rendering the view.
```

###### R: 3,1,2,4


# 12

What are the 4 different parts inside an HTTP request?
###### R: verb, url, headers, body

# 13

Are the HTTP requests in the config/routes.rb associated with their 2 routes the same? Why?

```

get "/songs" => "songs#index"
post "/songs" => "songs#create"

# Explain it here

```

###### R: Non, GET recupere des données, POST envoie des infos au serveur

# 14

What’s the difference between a GET and a POST request?
###### R: GET recupere des données, il n'y a pas un body
###### POST envoie des infos au serveur, il y a un body

# 15

Complete the controller code using the correct params key?
HTTP request: ```GET /search?query=thriller```
Routing in config/routes.rb: ```get "/search" => "songs#search"```


```

class SongsController < ApplicationController
  def search
    @songs = Song.where(title: params[:query])
  end
end

```

# 16

Complete the controller code using the correct params key?
HTTP request: ```GET /songs/named/thriller```
Routing in config/routes.rb: ```get "/songs/named/:name" => "songs#search"```

```

class SongsController < ApplicationController
  def search
    @songs = Song.where(title: params[:name])
  end
end

```

# 17

What are the 7 CRUD routes generated by the resources method ```resources :songs``` in Rails?

```
Prefix   Verb     URI Pattern Controller#Action
songs    GET    /songs(.:format)                       songs#index
         POST   /songs(.:format)                       songs#create
new_song GET    /songs/new(.:format)                   songs#new
edit_song GET    /songs/:id/edit(.:format)              songs#edit
song     GET    /songs/:id(.:format)                   songs#show
         PATCH  /songs/:id(.:format)                   songs#update
        PUT     /songs/:id(.:format)                   songs#update
        DELETE  /songs/:id(.:format)                  songs#destroy

```

# 18

How do you print your routes and their URL prefix helpers?

```
rails routes
rails routes | grep song
```

# 19

How do you generate a controller for your songs?

```
rails g controller songs
```

# 20

Implement the Read (CRUD) actions in your songs controller?

```
class SongsController < ApplicationController
  def index
    @songs = Song.all
  end

  def show
    @song = Song.find(params[:id])
  end
end

```

# 21

What are the 2 requests needed to create a new song? Implement the songs#new and songs#create actions.
S
```
class SongsController < ApplicationController
  def new #get
    @song = Song.new
  end

  def create #post
    @song = Song.new(song_params)
    if @song.save
      redirect_to song_path(@song)
    else
      render :new, status: :unprocessable_entity
    end
  end

  private

  def song_params
    params.require(:song).permit(:title, :year, :category)
  end
end
```

# 22

Why do we have to filter parameters using “strong params” in the controller?
###### R: Pour eviter que l'user puisse injecter des données malicieuses (se faire admin dans notre app)

# 23

Hard question: What is the HTML generated? Fill in the blanks:

Imagine that:
```@song = Song.new```

Now what is the HTML code generated by:
```<%= form_for @song do |f| %>```
```<%= f.text_field :title %>```
```<%= f.submit %>```
```<% end %>```


```
<form action="/songs" method="post">
  <input type="text" name="song[title]" value=" ">
  <input type="submit" value="Create song">
</form>
```

# 24

Hard question: What is the HTML generated? Fill in the blanks.
Imagine that:
```@song #=> <#Song: id: 18, title: "Hey jude", year: 1968, category: "rock">```

Now what is the HTML code generated by:
```<%= form_for @song do |f| %>```
```<%= f.text_field :title %>```
```<%= f.submit %>```
```<% end %>```

```
<form action="/songs/:id" method="patch">
  <input type="text" name="song[title]" value="Hey Jude"/>
  <input type="submit" value="Update song"/>
</form>
```

# 25

Now you want to add reviews to your app. Here are some constraints:
-We don’t want our visitors to destroy or update reviews, just to create ones.
-We don’t want a separate index page to list all reviews or a show page to display each review. Instead, we want to display reviews on the show page of each song, for better UX.
-Generate your Review model in the terminal. It should have only a ```content:string``` and a ```song:references``` (the foreign key).
```
rails g model review content song:references
```

# 26

Run the migration.
```
rails db:migrate
```

# 27

Add validations & associations.

Add a validation for the presence of a content.
Add associations between Review and Song

```
class Song < ApplicationRecord
  validates :title, presence: true
  has_many :reviews
end

class Review < ApplicationRecord
  belongs_to :song
  validates :content, presence: true
end

```

# 28

Generate the reviews controller.
```
rails g controller reviews
```

# 29

Add the necessary routes (we don’t want the 7 CRUD actions for reviews)

```
resources :songs do
    resources :reviews, only: [:new, :create]
  end
```

# 30

Now code your controller.

```
class ReviewsController < ApplicationController
  before_action :set_song

  def new
    @review = Review.new
  end

  def create
    @review = Review.new(review_params)
    @review.song = @song
    if @review.save
      redirect_to song_path(@song)
    else
      render :new, status: :unprocessable_entity
    end
  end

  private

  def set_song
    @song = Song.find(params[:song_id])
  end

  def review_params
    params.require(:review).permit(:content)
  end
end

```

# 31

Add a song’s reviews on its show page:

```

<h1><%= @song.title %></h1>
<p><%= @song.year %></p>
<p><%= @song.category %></p>

<h2>Here are the reviews for this song:</h2>
#TODO Add song's reviews.
# Song has_many Reviews
#review belongs_to song
#@song.reviews

<% @song.reviews.each do |review| %>
  <p><%= review.content %></p>
<% end %>
```
